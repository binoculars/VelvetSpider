<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-ajax/core-ajax.html">
<link rel="import" href="/bower_components/core-icon/core-icon.html">
<link rel="import" href="/bower_components/core-icons/core-icons.html">
<link rel="import" href="/bower_components/core-icons/social-icons.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/elements/eresidae-layout-default.html">

<polymer-element name="eresidae-profile">
	<template>
		<core-ajax auto
		           url="/api/listServices"
		           params=""
		           handleAs="json"
		           id="services"
		           on-core-response="{{coreResponse}}">
		</core-ajax>
		<core-ajax auto
		           url="/user"
		           params=""
		           handleAs="json"
		           id="user"
		           on-core-response="{{coreResponse}}">
		</core-ajax>
		<eresidae-layout-default style="display: block;">
			<h1 style="text-align: center;">Link Accounts</h1>
			<h3 style="text-align: center;"><a href="/query_console">Query Console</a></h3>
			<div vertical layout style="width:100%; height: 100%; display: block;">
				<template id="accounts" repeat="[[service in services]]">
					<div style="margin: 10px; display: block;">
						<div class="serviceName">
							<core-icon icon="[[service.icon]]"></core-icon> [[service.name]]
						</div>
						<hr>
						<div horizontal layout flex>
							<template if="{{ user[service.id].token }}">
								<div flex style="word-wrap: break-word;">
									<template bind="{{ user[service.id] }}">
										ID - [[id]]
										<br>
										Token - [[token]]
										<template if="{{refreshTokenOrTokenSecret}}">
											<br>
											TokenSecret - [[refreshTokenOrTokenSecret]]
										</template>
									</template>
								</div>
								<div>
									<a href="/unlink/[[service.id]]">
										<paper-button class="inverted" raised>Unlink</paper-button>
									</a>
								</div>
							</template>
							<template if="{{ !user[service.id].token }}">
								<div flex>
									<template if="{{ service.authType == 'none' }}">
										<span>No Auth Required</span>
									</template>
									<template if="{{ service.authType == 'oauth' }}">
										<a href="/connect/[[service.id]]">
											<paper-button class="inverted" raised>Connect</paper-button>
										</a>
									</template>
								</div>
							</template>
						</div>
					</div>
				</template>
			</div>
		</eresidae-layout-default>
	</template>
	<script>
		Polymer({
			coreResponse: function(e) {
				this.$.accounts.model[e.target.id] = e.detail.response;
				this.$.accounts.model = this.$.accounts.model;
			}
		});
	</script>
</polymer-element>