<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>

        <script src="/bower_components/platform/platform.js"></script>

        <link rel="import" href="/bower_components/polymer/polymer.html">

        <link rel="import" href="/bower_components/core-ajax/core-ajax.html">

        <link rel="import" href="/bower_components/core-icon/core-icon.html">
        <link rel="import" href="/bower_components/core-icons/core-icons.html">

        <link rel="import" href="/bower_components/core-icons/social-icons.html">

        <link rel="import" href="/bower_components/paper-button/paper-button.html">
        
        <link rel="import" href="/elements/eresidae-navbar.html">

        <link href="//fonts.googleapis.com/css?family=Varela+Round|Playball" rel="stylesheet" type="text/css">
        <link href="/stylesheets/style.css" rel="stylesheet" type="text/css">
        
        <style>
            html, body {
                height: 100%;
            }
        </style>
    </head>
    <body unresolved fullbleed vertical layout>
        <core-ajax auto
                   url="/api/listServices"
                   params=""
                   handleAs="json"
                   class="services">
        </core-ajax>
        <core-ajax auto
                   url="/user"
                   params=""
                   handleAs="json"
                   class="user">
        </core-ajax>
        
        <eresidae-navbar></eresidae-navbar>
        <div style="background-color: white; margin-left: 10%; margin-right: 10%;" flex vertical layout>
            <h1 style="text-align: center;">Link Accounts</h1>
            <h3 style="text-align: center;"><a href="/query_console">Query Console</a></h3>
            <div horizontal layout center center-justified wrap>
                <div vertical layout style="width: 80%;">
                
                    <template id="accounts" repeat="[[service in services]]">
                        <div style="margin: 10px;">
                            <div class="serviceName"><core-icon icon="[[service.icon]]"></core-icon> [[service.name]]</div>
                            <hr>
                            <div horizontal layout style="width: 100%;">
                                <template if="{{ user[service.id].token }}">
                                    <div flex style="word-wrap: break-word;">
                                        <template bind="{{ user[service.id] }}">
                                            ID - [[id]] <br>
                                            Token - [[token]] <br>
                                            TokenSecret - [[refreshTokenOrTokenSecret]]
                                        </template>
                                    </div>
                                    <div>
                                        <a href="/unlink/[[service.id]]">
                                            <paper-button class="inverted" raised>Unlink</paper-button>
                                        </a>
                                    </div>
                                </template>
                                <template if="{{ !user[service.id].token }}">
                                    <div flex>
                                        <a href="/connect/[[service.id]]">
                                            <paper-button class="inverted" raised>Connect</paper-button>
                                        </a>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('polymer-ready', function() {
                var template = document.querySelector('#accounts');
                template.bindingDelegate = new PolymerExpressions();
                template.model = {};

                ['services', 'user'].map(function(data) {
                    document.querySelector('core-ajax.' + data).addEventListener("core-response",
                        function (e) {
                            template.model[data] = e.detail.response;
                            template.model = template.model; // workaround for now. TODO: figure out how to automate this.
                        }
                    );
                });
            });
        </script>
    </body>
</html>